# 表单自动填充助手

一个基于 Plasmo 框架开发的浏览器插件，可以自动识别页面表单并调用科大讯飞大模型生成模拟数据，方便测试时快速填充表单。

## 功能特性

- ✅ **自动识别表单**：自动检测页面上的所有表单元素（input、textarea、select）
- ✅ **智能弹窗检测**：自动识别页面上的弹窗（Modal/Dialog），优先填充弹窗内的表单
- ✅ **智能提取标签**：自动获取表单字段的 label、name、placeholder 等信息
- ✅ **AI 生成数据**：调用科大讯飞 Spark API，根据字段类型和标签生成合适的模拟数据
- ✅ **自动填充**：一键填充所有表单字段，支持多种表单元素类型
- ✅ **支持多种字段类型**：支持文本、数字、日期、邮箱、手机号、复选框、单选框、下拉框等
- ✅ **框架兼容**：支持原生表单元素和 Ant Design 组件（日期选择器、下拉框等）
- ✅ **可拖拽按钮**：浮动按钮支持拖拽，位置自动保存
- ✅ **本地存储配置**：API 密钥仅存储在浏览器本地，安全可靠
- ✅ **双配置入口**：支持通过弹窗（Popup）和选项页面（Options）两种方式配置

## 技术栈

- **框架**：Plasmo 0.90.5
- **语言**：TypeScript 5.3.3
- **UI 框架**：React 18.2.0
- **样式**：Tailwind CSS 3.4.0
- **存储**：@plasmohq/storage 1.15.0
- **AI 接口**：科大讯飞 Spark API

## 项目结构

```
auto-fill-extension/
├── content.tsx          # 内容脚本，在页面上插入自动填充按钮
├── popup.tsx            # 弹窗配置页面，快速配置API密钥
├── options.tsx          # 选项页面，详细配置界面（含示例图片）
├── background.ts        # 后台脚本，处理跨域API调用
├── lib/
│   ├── spark-api.ts    # 科大讯飞 API 调用模块（备用）
│   └── form-utils.ts   # 表单工具函数（识别、填充表单）
├── assets/
│   ├── icon.png        # 插件图标
│   └── 示例图片.png    # API配置示例图片
├── style.css           # 全局样式
├── package.json        # 项目配置
├── tsconfig.json       # TypeScript配置
└── README.md          # 说明文档
```

## 安装步骤

### 1. 安装依赖

```bash
cd auto-fill-extension
pnpm install
# 或
npm install
```

### 2. 开发模式

```bash
pnpm dev
```

### 3. 加载插件

1. 打开 Chrome 浏览器，访问 `chrome://extensions/`
2. 开启右上角的"开发者模式"
3. 点击"加载已解压的扩展程序"
4. 选择项目的 `build/chrome-mv3-dev` 文件夹

### 4. 配置 API 密钥

有两种配置方式：

#### 方式一：通过弹窗配置（推荐）

1. 点击浏览器工具栏中的扩展图标
2. 在弹窗中输入科大讯飞 APIPassword
3. 点击"保存配置"按钮
4. 如需查看详细说明，点击"📷 查看示例"按钮

#### 方式二：通过选项页面配置

1. 右键点击扩展图标，选择"选项"
2. 在选项页面中查看详细的配置说明和示例图片
3. 输入 APIPassword 并选择模型版本（推荐使用 lite）
4. 点击"保存配置"按钮

### 5. 获取 API 密钥

1. 访问 [科大讯飞控制台](https://console.xfyun.cn/services/cbm)
2. 注册/登录账号，完成实名认证（如需要）
3. 在左侧菜单选择"星火认知大模型" → "Spark Lite"（或其他版本）
4. 在页面右侧找到"HTTP 服务接口认证信息"部分
5. 在"鉴权信息"子部分中，找到"APIPassword"字段
6. 点击 APIPassword 值旁边的"复制"按钮
7. 将复制的 APIPassword 粘贴到配置页面（不需要 Bearer 前缀）

## 使用方法

1. 打开包含表单的网页
2. 页面右上角会自动显示"自动填充"按钮（如果检测到表单）
3. 如果页面有弹窗表单，插件会自动识别并优先填充弹窗内的表单
4. 点击"自动填充"按钮
5. 插件会自动识别表单字段，调用 AI 生成数据并填充
6. 按钮支持拖拽，可以调整到合适的位置，位置会自动保存

## 核心功能说明

### 1. 表单识别 (`lib/form-utils.ts`)

#### `hasFormElements()`

- 检查页面是否有表单元素
- 用于决定是否显示自动填充按钮

#### `getFormFields()`

- 获取页面所有表单字段信息
- 自动识别 input、textarea、select 元素
- 提取字段的 label、name、id、type、placeholder 等信息
- **智能弹窗检测**：如果页面有打开的弹窗，只检查弹窗内的表单元素
- 支持多种方式查找 label（优先通过 `label[for]` 属性关联）

#### `fillFormData()`

- 填充表单数据
- 根据字段的 name 或 id 匹配数据
- 支持不同类型的表单元素（文本、选择框、复选框、单选框等）
- **框架兼容**：支持 Ant Design 日期选择器和下拉框组件
- 自动触发 input 和 change 事件，确保表单验证正常工作
- **智能弹窗检测**：如果页面有打开的弹窗，只填充弹窗内的表单元素

#### `findActiveModal()`

- 查找当前活动的弹窗（Modal/Dialog）元素
- 通过检查定位属性（position: fixed/absolute）和 z-index 来判断
- 优先返回 z-index 最高的弹窗

### 2. AI 数据生成 (`background.ts`)

- 通过 Background Service Worker 调用科大讯飞 Spark API
- 避免 CORS 跨域问题
- 根据字段类型和标签生成符合实际场景的模拟数据
- 支持多种数据类型：姓名、手机号、邮箱、日期、数字、文本、公司名称、地址等
- 每次生成的数据都具有随机性和多样性
- 固定使用 `lite` 模型（性价比最高）

### 3. 内容脚本 (`content.tsx`)

- 在页面上插入浮动按钮
- 动态检测页面是否有表单元素
- 支持按钮拖拽，位置自动保存到本地存储
- 处理用户点击，通过消息传递调用 Background Service Worker
- 显示加载状态和错误提示

### 4. 配置页面

#### 弹窗配置 (`popup.tsx`)

- 快速配置界面，适合首次使用
- 固定使用 `lite` 模型
- 提供"查看示例"按钮，跳转到选项页面查看详细说明

#### 选项页面 (`options.tsx`)

- 详细配置界面，包含完整的配置说明
- 显示示例图片，帮助用户了解如何获取 APIPassword
- 支持选择不同的模型版本（lite、pro、pro-128k、max、max-32k、4.0-ultra）
- 提供详细的常见问题解答

### 5. 后台脚本 (`background.ts`)

- 监听来自 content script 的消息
- 代为调用科大讯飞 API，避免 CORS 问题
- 从本地存储读取 API 配置
- 构建提示词，调用 API 生成表单数据
- 解析 API 返回的 JSON 数据

## 科大讯飞 API 配置

### 支持的模型版本

- `lite`: 轻量级模型，性价比高（推荐，默认使用）
- `pro`: 专业版模型
- `pro-128k`: 专业版 128k 上下文
- `max`: 最大模型
- `max-32k`: 最大模型 32k 上下文
- `4.0-ultra`: 4.0 超强版

### API 接口信息

- **接口地址**：`https://spark-api-open.xf-yun.com/v1/chat/completions`
- **认证方式**：Bearer Token（使用 APIPassword）
- **请求格式**：JSON
- **响应格式**：JSON

### 配置说明

1. **APIPassword 格式**：直接复制控制台中的 APIPassword 值即可，不需要添加 "Bearer" 前缀
2. **配置存储**：所有配置仅保存在浏览器本地存储中，不会上传到任何服务器
3. **配置位置**：可以通过弹窗（Popup）或选项页面（Options）两种方式配置

## 注意事项

1. **API 费用**：使用科大讯飞 API 会产生费用，请注意控制使用量。推荐使用 `lite` 模型，性价比最高
2. **数据安全**：API 密钥仅存储在浏览器本地，不会上传到任何服务器，不会发送到后台，完全本地化处理
3. **字段匹配**：插件通过字段的 name 或 id 属性匹配数据，确保表单字段有正确的 name 或 id
4. **网络要求**：需要能够访问科大讯飞 API 服务器（https://spark-api-open.xf-yun.com）
5. **弹窗识别**：插件会自动识别页面上的弹窗，优先填充弹窗内的表单。如果弹窗没有正确识别，可以尝试关闭弹窗后重新打开
6. **框架兼容**：插件支持原生表单元素和 Ant Design 组件，其他框架的组件可能需要额外适配

## 开发

### 构建生产版本

```bash
pnpm build
```

构建完成后，在 `build/chrome-mv3-prod` 目录找到生产版本。

### 打包插件

```bash
pnpm package
```

### 生成图标

```bash
pnpm generate-icons
```

## 常见问题

### Q: 按钮没有显示？

A: 检查页面是否有表单元素（input、textarea、select），插件会自动检测并显示按钮。如果页面是动态加载的，可能需要等待页面加载完成。

### Q: 提示"请先配置 API 密钥"？

A: 需要先配置科大讯飞 API 密钥。有两种方式：

- 点击扩展图标，在弹窗中配置
- 右键点击扩展图标，选择"选项"进行配置

### Q: 生成的数据不符合预期？

A: 确保表单字段有清晰的 label 或 placeholder，AI 会根据这些信息生成数据。如果字段没有 label，插件会尝试使用 name 或 id。建议表单字段使用标准的 `<label for="fieldId">` 结构。

### Q: 某些字段没有被填充？

A: 检查字段是否有 name 或 id 属性，插件通过这两个属性匹配数据。如果字段没有这些属性，可能无法正确匹配。另外，确保字段没有被禁用（disabled）。

### Q: 弹窗内的表单没有被填充？

A: 插件会自动检测弹窗，但如果弹窗的 z-index 较低或没有正确的标识，可能无法识别。可以尝试：

1. 关闭弹窗后重新打开
2. 确保弹窗有较高的 z-index（>= 1000）或包含 modal/dialog 相关的 class 名称

### Q: Ant Design 组件没有被正确填充？

A: 插件已经支持 Ant Design 的日期选择器和下拉框组件。如果其他 Ant Design 组件没有被正确填充，可能需要额外适配。

### Q: 配置会保存到哪里？

A: 所有配置仅保存在浏览器本地存储（Chrome Extension Storage API）中，不会上传到任何服务器，不会发送到后台。即使插件开发者也无法访问您的配置信息。

### Q: 更换浏览器后需要重新配置吗？

A: 是的，因为配置保存在浏览器本地，更换浏览器或清除浏览器数据后需要重新配置。

## 许可证

UNLICENSED
